<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title></title>
  <script src="notes.js"></script>
</head>
<body>
  <h1> NOTES </h1>
  <textarea id="note-content" placeholder="enter text..."></textarea>
  <input id="add-note" type="submit" value="create">
  <ul id="notes">

  </ul>
  <h1> My note </h1>
  <div id="full"></div>
  <script>
  mynotes = new Notes();
  mynotes.items = ['hellohellohellohello!!!'];
  notes = mynotes.items;

  createNote();

  testCreateNote();

  var addNoteToList = function(note) {
    var a = document.createElement('a');
    var ul = document.getElementById("notes");
    var li = document.createElement("li");
    var text = document.createTextNode(truncator(note));
    a.id = notes.length -1;
    a.title = text;
    a.href = "#" + a.id;
    a.appendChild(text);
    li.appendChild(a);
    ul.appendChild(li);
  }
  //
  // var renderNoteList = function(notes) {
  //   notes.forEach(function(note, index){
  //     var a = document.createElement('a');
  //     var ul = document.getElementById("notes");
  //     var li = document.createElement("li");
  //     var text = document.createTextNode(truncator(note));
  //     a.id = index;
  //     a.title = text;
  //     a.href = "#" + index;
  //     a.appendChild(text);
  //     li.appendChild(a);
  //     ul.appendChild(li);
  //   });
  // }

  // renderNoteList(notes);

  makeURLRenderFullNote();

  function createNote() {
    document.getElementById("add-note").addEventListener("click", function() {
      mynotes.items.push(document.getElementById("note-content").value)
      addNoteToList(notes[notes.length - 1]);
    });
  }

  function makeURLRenderFullNote() {
    window.addEventListener("hashchange", getNoteIdForCurrentPage);
  }

  function getNoteIdForCurrentPage () {
    showNote(getNoteFromUrl(window.location));
  }

  function getNoteFromUrl (location) {
    return location.hash.split("#")[1];
  }

  function showNote(index) {
    document
    .getElementById("full")
    .innerHTML = mynotes.items[index];
  }

  testLink();

  function testLink () {
    document.getElementById(0).click();
    function test() {
      if (document.getElementById("full").innerHTML !== 'hellohellohellohello!!!') {
        throw new Error("This is not the full note");
      }
    }
    setTimeout(test, 10);
  }

  function testTruncator (notes) {
    renderNoteList(notes);
    if (document.getElementById(0).text.length < 23) {
      throw new Error("Note not abbreviated");
    }
  }

  function testCreateNote () {
    document.getElementById("note-content").value = "GET UP EARLIER!"
    document.getElementById("add-note").click();
    if (mynotes.items.length !== 2) {
      throw new Error("Note array length has not increased");
    }
    if (mynotes.items[1] != "GET UP EARLIER!") {
      throw new Error("Text was not found in array");
    }
  }
</script>
</body>
</html>
